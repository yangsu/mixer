function FourierTransform(t,e){this.bufferSize=t,this.sampleRate=e,this.bandwidth=2/t*e/2,this.spectrum=new Float32Array(t/2),this.real=new Float32Array(t),this.imag=new Float32Array(t),this.peakBand=0,this.peak=0,this.getBandFrequency=function(t){return this.bandwidth*t+this.bandwidth/2},this.calculateSpectrum=function(){for(var e,i,a,s=this.spectrum,n=this.real,o=this.imag,r=2/this.bufferSize,u=Math.sqrt,h=0,l=t/2;l>h;h++)e=n[h],i=o[h],a=r*u(e*e+i*i),a>this.peak&&(this.peakBand=h,this.peak=a),s[h]=a}}function FFT(t,e){FourierTransform.call(this,t,e),this.reverseTable=new Uint32Array(t);for(var i,a=1,s=t>>1;t>a;){for(i=0;a>i;i++)this.reverseTable[i+a]=this.reverseTable[i]+s;a<<=1,s>>=1}for(this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t),i=0;t>i;i++)this.sinTable[i]=Math.sin(-Math.PI/i),this.cosTable[i]=Math.cos(-Math.PI/i)}this.mixer=this.mixer||{},this.mixer.Templates=this.mixer.Templates||{},this.mixer.Templates.track=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class="row text-center track-container">\n    <div class="track span12">\n        <canvas class="waveform" width="5000" height="100"></canvas>\n    </div>\n    <canvas class="fft" width="960" height="100"></canvas>\n</div>\n<div class="row">\n    <div class="span4">\n        <div class="btn-toolbar">\n          <div class="btn-group">\n            <a class="btn disabled" href="#"><i class="icon-backward"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-play"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-stop"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-forward"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-resize-full"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-resize-small"></i></a>\n          </div>\n        </div>\n        <div class="btn-toolbar">\n          <div class="btn-group">\n            <span class="volume"><i class="icon-volume-up"></i></span>\n            <span class="vslider span3"></span>\n          </div>\n        </div>\n        <div class="btn-toolbar">\n          <div class="btn-group">\n            <span class="speed"><i class="icon-time"></i></span>\n            <span class="sslider span3"></span>\n          </div>\n        </div>\n        <div>\n            BPM <span class="bpm">0</span>\n        </div>\n    </div>\n    <div class="span4">\n        <label for="filtertype">Filter Type:</label>\n        <select name="type" id="filtertype">\n            <option value="lowpass">Lowpass</option>\n            <option value="highpass">Highpass</option>\n            <option value="bandpass">Bandpass</option>\n            <option value="lowshelf">Lowshelf</option>\n            <option value="highshelf">Highshelf</option>\n            <option value="peaking">Peaking</option>\n            <option value="notch">Notch</option>\n            <option value="allpass">Allpass</option>\n        </select>\n        <label for="enableFilter">Enable Filter:</label>\n        <input type="checkbox" id="enableFilter" checked>\n        <label for="enableChorus">Enable Chorus:</label>\n        <input type="checkbox" id="enableChorus" checked>\n    </div>\n    <div class="span4">\n        <label for="fslider">Frequency Cutoff:</label>\n        <div class="fslider" style=""></div>\n        <label for="qslider">Q Factor:</label>\n        <div class="qslider" style=""></div>\n        <label for="gslider">Gain:</label>\n        <div class="gslider" style=""></div>\n    </div>\n</div>';return __p},!function(t){var e=function(e,i){this.element=t(e),this.picker=t('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div><div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element),this.id=this.element.data("slider-id")||i.id,this.id&&(this.picker[0].id=this.id),"undefined"!=typeof Modernizr&&Modernizr.touch&&(this.touchCapable=!0);var a=this.element.data("slider-tooltip")||i.tooltip;switch(this.tooltip=this.picker.find(".tooltip"),this.tooltipInner=this.tooltip.find("div.tooltip-inner"),this.orientation=this.element.data("slider-orientation")||i.orientation,this.orientation){case"vertical":this.picker.addClass("slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this.tooltip.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",this.element.outerWidth()),this.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px"}this.min=this.element.data("slider-min")||i.min,this.max=this.element.data("slider-max")||i.max,this.step=this.element.data("slider-step")||i.step,this.value=this.element.data("slider-value")||i.value,this.value[1]&&(this.range=!0),this.selection=this.element.data("slider-selection")||i.selection,this.selectionEl=this.picker.find(".slider-selection"),"none"===this.selection&&this.selectionEl.addClass("hide"),this.selectionElStyle=this.selectionEl[0].style,this.handle1=this.picker.find(".slider-handle:first"),this.handle1Stype=this.handle1[0].style,this.handle2=this.picker.find(".slider-handle:last"),this.handle2Stype=this.handle2[0].style;var s=this.element.data("slider-handle")||i.handle;switch(s){case"round":this.handle1.addClass("round"),this.handle2.addClass("round");break;case"triangle":this.handle1.addClass("triangle"),this.handle2.addClass("triangle")}this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.value[1]="after"==this.selection?this.max:this.min),this.diff=this.max-this.min,this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff],this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos],this.formater=i.formater,this.layout(),this.touchCapable?this.picker.on({touchstart:t.proxy(this.mousedown,this)}):this.picker.on({mousedown:t.proxy(this.mousedown,this)}),"show"===a?this.picker.on({mouseenter:t.proxy(this.showTooltip,this),mouseleave:t.proxy(this.hideTooltip,this)}):this.tooltip.addClass("hide")};e.prototype={constructor:e,over:!1,inDrag:!1,showTooltip:function(){this.tooltip.addClass("in"),this.over=!0},hideTooltip:function(){this.inDrag===!1&&this.tooltip.removeClass("in"),this.over=!1},layout:function(){this.handle1Stype[this.stylePos]=this.percentage[0]+"%",this.handle2Stype[this.stylePos]=this.percentage[1]+"%","vertical"==this.orientation?(this.selectionElStyle.top=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.height=Math.abs(this.percentage[0]-this.percentage[1])+"%"):(this.selectionElStyle.left=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.width=Math.abs(this.percentage[0]-this.percentage[1])+"%"),this.range?(this.tooltipInner.text(this.formater(this.value[0])+" : "+this.formater(this.value[1])),this.tooltip[0].style[this.stylePos]=this.size*(this.percentage[0]+(this.percentage[1]-this.percentage[0])/2)/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px"):(this.tooltipInner.text(this.formater(this.value[0])),this.tooltip[0].style[this.stylePos]=this.size*this.percentage[0]/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px")},mousedown:function(e){this.touchCapable&&"touchstart"===e.type&&(e=e.originalEvent),this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos];var i=this.getPercentage(e);if(this.range){var a=Math.abs(this.percentage[0]-i),s=Math.abs(this.percentage[1]-i);this.dragged=s>a?0:1}else this.dragged=0;this.percentage[this.dragged]=i,this.layout(),this.touchCapable?t(document).on({touchmove:t.proxy(this.mousemove,this),touchend:t.proxy(this.mouseup,this)}):t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),this.inDrag=!0;var n=this.calculateValue();return this.element.trigger({type:"slideStart",value:n}).trigger({type:"slide",value:n}),!1},mousemove:function(t){this.touchCapable&&"touchmove"===t.type&&(t=t.originalEvent);var e=this.getPercentage(t);this.range&&(0===this.dragged&&e>this.percentage[1]?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>e&&(this.percentage[1]=this.percentage[0],this.dragged=0)),this.percentage[this.dragged]=e,this.layout();var i=this.calculateValue();return this.element.trigger({type:"slide",value:i}).data("value",i).prop("value",i),!1},mouseup:function(){this.touchCapable?t(document).off({touchmove:this.mousemove,touchend:this.mouseup}):t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.inDrag=!1,0==this.over&&this.hideTooltip(),this.element;var e=this.calculateValue();return this.element.trigger({type:"slideStop",value:e}).data("value",e).prop("value",e),!1},calculateValue:function(){var t;return this.range?(t=[this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.min+Math.round(this.diff*this.percentage[1]/100/this.step)*this.step],this.value=t):(t=this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.value=[t,this.value[1]]),t},getPercentage:function(t){this.touchCapable&&(t=t.touches[0]);var e=100*(t[this.mousePos]-this.offset[this.stylePos])/this.size;return e=Math.round(e/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,e))},getValue:function(){return this.range?this.value:this.value[0]},setValue:function(t){this.value=t,this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.value[1]="after"==this.selection?this.max:this.min),this.diff=this.max-this.min,this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff],this.layout()}},t.fn.slider=function(i,a){return this.each(function(){var s=t(this),n=s.data("slider"),o="object"==typeof i&&i;n||s.data("slider",n=new e(this,t.extend({},t.fn.slider.defaults,o))),"string"==typeof i&&n[i](a)})},t.fn.slider.defaults={min:0,max:10,step:1,orientation:"horizontal",value:5,selection:"before",tooltip:"show",handle:"round",formater:function(t){return t}},t.fn.slider.Constructor=e}(window.jQuery),function(){function t(){for(var t in this.sections)this.sections[t].condition()&&this.sections[t].callback.call(this)}var e=function(){this.audioAdapter=e._getAdapter(this),this.events={},this.sections=[],this.bind("update",t)};e.version="0.3.2",e.adapters={},e.prototype={load:function(t){return t instanceof HTMLElement?(this.source=t,"flash"===e.isSupported()&&(this.source={src:e._getMP3SrcFromAudio(t)})):(this.source=window.Audio?new Audio:{},this.source.src=e._makeSupportedPath(t.src,t.codecs)),this.audio=this.audioAdapter.load(this.source),this},play:function(){return this.audioAdapter.play(),this},pause:function(){return this.audioAdapter.pause(),this},setVolume:function(t){return this.audioAdapter.setVolume(t),this},createKick:function(t){return new e.Kick(this,t)},bind:function(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),this},unbind:function(t){return this.events[t]&&delete this.events[t],this},trigger:function(t){var e=this;return this.events[t]&&this.events[t].forEach(function(t){t.call(e)}),this},getVolume:function(){return this.audioAdapter.getVolume()},getProgress:function(){return this.audioAdapter.getProgress()},getTime:function(){return this.audioAdapter.getTime()},getFrequency:function(t,e){var i=0;if(void 0!==e){for(var a=t;e>=a;a++)i+=this.getSpectrum()[a];return i/(e-t+1)}return this.getSpectrum()[t]},getWaveform:function(){return this.audioAdapter.getWaveform()},getSpectrum:function(){return this.audioAdapter.getSpectrum()},isLoaded:function(){return this.audioAdapter.isLoaded},isPlaying:function(){return this.audioAdapter.isPlaying},after:function(t,e){var i=this;return this.sections.push({condition:function(){return i.getTime()>t},callback:e}),this},before:function(t,e){var i=this;return this.sections.push({condition:function(){return t>i.getTime()},callback:e}),this},between:function(t,e,i){var a=this;return this.sections.push({condition:function(){return a.getTime()>t&&e>a.getTime()},callback:i}),this},onceAt:function(t,e){var i=this,a=null;return this.sections.push({condition:function(){return i.getTime()>t&&!this.called},callback:function(){e.call(this),a.called=!0},called:!1}),a=this.sections[this.sections.length-1],this}},window.Dancer=e}(),function(t){function e(){var t=!!(navigator.vendor||"").match(/Apple/),e=navigator.userAgent.match(/Version\/([^ ]*)/);return e=e?parseFloat(e[1]):0,t&&6>=e}var i={mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',aac:'audio/mp4; codecs="mp4a.40.2"'},a=document.createElement("audio");t.options={},t.setOptions=function(e){for(var i in e)e.hasOwnProperty(i)&&(t.options[i]=e[i])},t.isSupported=function(){return window.Float32Array&&window.Uint32Array?e()||!window.AudioContext&&!window.webkitAudioContext?a&&a.mozSetup?"audiodata":FlashDetect.versionAtLeast(9)?"flash":"":"webaudio":null},t.canPlay=function(e){return a.canPlayType,!!("flash"===t.isSupported()?"mp3"===e.toLowerCase():a.canPlayType&&a.canPlayType(i[e.toLowerCase()]).replace(/no/,""))},t.addPlugin=function(e,i){void 0===t.prototype[e]&&(t.prototype[e]=i)},t._makeSupportedPath=function(e,i){if(!i)return e;for(var a=0;i.length>a;a++)if(t.canPlay(i[a]))return e+"."+i[a];return e},t._getAdapter=function(e){switch(t.isSupported()){case"webaudio":return new t.adapters.webkit(e);case"audiodata":return new t.adapters.moz(e);case"flash":return new t.adapters.flash(e);default:return null}},t._getMP3SrcFromAudio=function(t){var e=t.children;if(t.src)return t.src;for(var i=e.length;i--;)if((e[i].type||"").match(/audio\/mpeg/))return e[i].src;return null}}(window.Dancer),function(t){var e=function(e,i){i=i||{},this.dancer=e,this.frequency=i.frequency!==t?i.frequency:[0,10],this.threshold=i.threshold!==t?i.threshold:.3,this.decay=i.decay!==t?i.decay:.02,this.onKick=i.onKick,this.offKick=i.offKick,this.isOn=!1,this.currentThreshold=this.threshold;var a=this;this.dancer.bind("update",function(t,e){a.onUpdate(t,e)})};e.prototype={on:function(){return this.isOn=!0,this},off:function(){return this.isOn=!1,this},set:function(e){e=e||{},this.frequency=e.frequency!==t?e.frequency:this.frequency,this.threshold=e.threshold!==t?e.threshold:this.threshold,this.decay=e.decay!==t?e.decay:this.decay,this.onKick=e.onKick||this.onKick,this.offKick=e.offKick||this.offKick},onUpdate:function(t,e){if(this.isOn){var i=this.maxAmplitude(this.frequency);i>=this.currentThreshold&&i>=this.threshold?(this.currentThreshold=i,this.onKick&&this.onKick.call(this.dancer,i,e,t)):(this.offKick&&this.offKick.call(this.dancer,i,e,t),this.currentThreshold-=this.decay)}},maxAmplitude:function(t){var e=0,i=this.dancer.getSpectrum();if(!t.length)return i.length>t?i[~~t]:null;for(var a=t[0],s=t[1];s>=a;a++)i[a]>e&&(e=i[a]);return e}},window.Dancer.Kick=e}(),function(){function t(){this.source=this.context.createMediaElementSource(this.audio),this.source.connect(this.proc),this.source.connect(this.gain),this.gain.connect(this.context.destination),this.proc.connect(this.context.destination),this.isLoaded=!0,this.progress=1,this.dancer.trigger("loaded")}var e=2048,i=44100,a=function(t){this.dancer=t,this.audio=new Audio,this.context=window.AudioContext?new window.AudioContext:new window.webkitAudioContext};a.prototype={load:function(a){var s=this;return this.audio=a,this.isLoaded=!1,this.progress=0,this.proc=this.context.createJavaScriptNode(e/2,1,1),this.proc.onaudioprocess=function(t){s.update.call(s,t)},this.gain=this.context.createGainNode(),this.fft=new FFT(e/2,i),this.signal=new Float32Array(e/2),3>this.audio.readyState?this.audio.addEventListener("canplay",function(){t.call(s)}):t.call(s),this.audio.addEventListener("progress",function(t){t.currentTarget.duration&&(s.progress=t.currentTarget.seekable.end(0)/t.currentTarget.duration)}),this.audio},play:function(){this.audio.play(),this.isPlaying=!0},pause:function(){this.audio.pause(),this.isPlaying=!1},setVolume:function(t){this.gain.gain.value=t},getVolume:function(){return this.gain.gain.value},getProgress:function(){return this.progress},getWaveform:function(){return this.signal},getSpectrum:function(){return this.fft.spectrum},getTime:function(){return this.audio.currentTime},update:function(t){if(this.isPlaying&&this.isLoaded){var i,a=[],s=t.inputBuffer.numberOfChannels,n=e/s,o=function(t,e){return t[i]+e[i]};for(i=s;i--;)a.push(t.inputBuffer.getChannelData(i));for(i=0;n>i;i++)this.signal[i]=s>1?a.reduce(o)/s:a[0][i];this.fft.forward(this.signal),this.dancer.trigger("update")}}},Dancer.adapters.webkit=a}(),function(){function t(){this.fbLength=this.audio.mozFrameBufferLength,this.channels=this.audio.mozChannels,this.rate=this.audio.mozSampleRate,this.fft=new FFT(this.fbLength/this.channels,this.rate),this.signal=new Float32Array(this.fbLength/this.channels),this.isLoaded=!0,this.progress=1,this.dancer.trigger("loaded")}var e=function(t){this.dancer=t,this.audio=new Audio};e.prototype={load:function(e){var i=this;return this.audio=e,this.isLoaded=!1,this.progress=0,3>this.audio.readyState?this.audio.addEventListener("loadedmetadata",function(){t.call(i)},!1):t.call(i),this.audio.addEventListener("MozAudioAvailable",function(t){i.update(t)},!1),this.audio.addEventListener("progress",function(t){t.currentTarget.duration&&(i.progress=t.currentTarget.seekable.end(0)/t.currentTarget.duration)},!1),this.audio},play:function(){this.audio.play(),this.isPlaying=!0},pause:function(){this.audio.pause(),this.isPlaying=!1},setVolume:function(t){this.audio.volume=t},getVolume:function(){return this.audio.volume},getProgress:function(){return this.progress},getWaveform:function(){return this.signal},getSpectrum:function(){return this.fft.spectrum},getTime:function(){return this.audio.currentTime},update:function(t){if(this.isPlaying&&this.isLoaded){for(var e=0,i=this.fbLength/2;i>e;e++)this.signal[e]=(t.frameBuffer[2*e]+t.frameBuffer[2*e+1])/2;this.fft.forward(this.signal),this.dancer.trigger("update")}}},Dancer.adapters.moz=e}(),function(){function t(){var t=this;n=!0,e(Dancer.options.flashJS,function(){soundManager=new SoundManager,soundManager.flashVersion=9,soundManager.flash9Options.useWaveformData=!0,soundManager.useWaveformData=!0,soundManager.useHighPerformance=!0,soundManager.useFastPolling=!0,soundManager.multiShot=!1,soundManager.debugMode=!1,soundManager.debugFlash=!1,soundManager.url=Dancer.options.flashSWF,soundManager.onready(function(){s=!0,t.load()}),soundManager.ontimeout(function(){console.error("Error loading SoundManager2.swf")}),soundManager.beginDelayedInit()})}function e(t,e){var i=document.createElement("script"),a=document.getElementsByTagName("script")[0];i.type="text/javascript",i.src=t,i.onload=e,a.parentNode.insertBefore(i,a)}var i=1024,a=44100,s=!1,n=!1,o=.93,r=function(t){this.dancer=t,this.wave_L=[],this.wave_R=[],this.spectrum=[],window.SM2_DEFER=!0};r.prototype={load:function(e){var s=this;return this.path=e?e.src:this.path,this.isLoaded=!1,this.progress=0,!window.soundManager&&!n&&t.call(this),window.soundManager&&(this.audio=soundManager.createSound({id:"dancer"+Math.random(),url:this.path,stream:!0,autoPlay:!1,autoLoad:!0,whileplaying:function(){s.update()},whileloading:function(){s.progress=this.bytesLoaded/this.bytesTotal},onload:function(){s.fft=new FFT(i,a),s.signal=new Float32Array(i),s.waveform=new Float32Array(i),s.isLoaded=!0,s.progress=1,s.dancer.trigger("loaded")}}),this.dancer.audio=this.audio),this.audio},play:function(){this.audio.play(),this.isPlaying=!0},pause:function(){this.audio.pause(),this.isPlaying=!1},setVolume:function(t){this.audio.setVolume(100*t)},getVolume:function(){return this.audio.volume/100},getProgress:function(){return this.progress},getWaveform:function(){return this.waveform},getSpectrum:function(){return this.fft.spectrum},getTime:function(){return this.audio.position/1e3},update:function(){if(this.isPlaying||this.isLoaded){this.wave_L=this.audio.waveformData.left,this.wave_R=this.audio.waveformData.right;for(var t,e=0,i=this.wave_L.length;i>e;e++)t=parseFloat(this.wave_L[e])+parseFloat(this.wave_R[e]),this.waveform[2*e]=t/2,this.waveform[2*e+1]=t/2,this.signal[2*e]=t*o,this.signal[2*e+1]=t*o;this.fft.forward(this.signal),this.dancer.trigger("update")}}},Dancer.adapters.flash=r}(),FFT.prototype.forward=function(t){var e=this.bufferSize,i=this.cosTable,a=this.sinTable,s=this.reverseTable,n=this.real,o=this.imag;this.spectrum;var r=Math.floor(Math.log(e)/Math.LN2);if(Math.pow(2,r)!==e)throw"Invalid buffer size, must be a power of 2.";if(e!==t.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+e+" Buffer Size: "+t.length;var u,h,l,c,d,f,p,v,m,g=1;for(m=0;e>m;m++)n[m]=t[s[m]],o[m]=0;for(;e>g;){u=i[g],h=a[g],l=1,c=0;for(var y=0;g>y;y++){for(m=y;e>m;)d=m+g,f=l*n[d]-c*o[d],p=l*o[d]+c*n[d],n[d]=n[m]-f,o[d]=o[m]-p,n[m]+=f,o[m]+=p,m+=g<<1;v=l,l=v*u-c*h,c=v*h+c*u}g<<=1}return this.calculateSpectrum()};var FlashDetect=new function(){var t=this;t.installed=!1,t.raw="",t.major=-1,t.minor=-1,t.revision=-1,t.revisionStr="";var e=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(t){return a(t)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(t){var e="6,0,21";try{t.AllowScriptAccess="always",e=a(t)}catch(i){}return e}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(t){return a(t)}}],a=function(t){var e=-1;try{e=t.GetVariable("$version")}catch(i){}return e},s=function(t){var e=-1;try{e=new ActiveXObject(t)}catch(i){e={activeXError:!0}}return e},n=function(t){var e=t.split(",");return{raw:t,major:parseInt(e[0].split(" ")[1],10),minor:parseInt(e[1],10),revision:parseInt(e[2],10),revisionStr:e[2]}},o=function(t){var e=t.split(/ +/),i=e[2].split(/\./),a=e[3];return{raw:t,major:parseInt(i[0],10),minor:parseInt(i[1],10),revisionStr:a,revision:r(a)}},r=function(e){return parseInt(e.replace(/[a-zA-Z]/g,""),10)||t.revision};t.majorAtLeast=function(e){return t.major>=e},t.minorAtLeast=function(e){return t.minor>=e},t.revisionAtLeast=function(e){return t.revision>=e},t.versionAtLeast=function(){var e=[t.major,t.minor,t.revision],a=Math.min(e.length,arguments.length);for(i=0;a>i;i++){if(e[i]>=arguments[i]){if(a>i+1&&e[i]==arguments[i])continue;return!0}return!1}},t.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var i="application/x-shockwave-flash",a=navigator.mimeTypes;if(a&&a[i]&&a[i].enabledPlugin&&a[i].enabledPlugin.description){var r=a[i].enabledPlugin.description,u=o(r);t.raw=u.raw,t.major=u.major,t.minor=u.minor,t.revisionStr=u.revisionStr,t.revision=u.revision,t.installed=!0}}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var r=-1,h=0;e.length>h&&-1==r;h++){var l=s(e[h].name);if(!l.activeXError&&(t.installed=!0,r=e[h].version(l),-1!=r)){var u=n(r);t.raw=u.raw,t.major=u.major,t.minor=u.minor,t.revision=u.revision,t.revisionStr=u.revisionStr}}}()};FlashDetect.JS_RELEASE="1.0.4",function(t){function e(t){return Math.max(0,Math.round(100*Math.pow(2,t/6))/100)}function i(t,e){var i,a,s=0,n=0,o=0,r=0;return i=t.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(i[2],10)-(i[1]+"").length,i=e.toExponential().match(/^.\.?(.*)e(.+)$/),n=parseInt(i[2],10)-(i[1]+"").length,n>s&&(s=n),a=t%e,-100>s||s>20?(o=Math.round(Math.log(a)/Math.log(10)),r=Math.pow(10,o),(a/r).toFixed(o-s)*r):parseFloat(a.toFixed(-s))}function a(t){return 0===t?1:Math.abs(t)/t}function s(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}var n,o,r=function(e){t.AudioContext||(t.AudioContext=t.webkitAudioContext),e||(console.log("tuna.js: Missing audio context! Creating a new context for you."),e=t.AudioContext&&new t.AudioContext),n=e,o=this},u="0.1",h="setValueAtTime",l="linearRampToValueAtTime",c=function(t,e){t.value=e},d=Object.create(null,{activate:{writable:!0,value:function(t){t?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(t)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(t){this._lastBypassValue!==t&&(this._bypass=t,this.activate(!t),this._lastBypassValue=t)}},connect:{value:function(t){this.output.connect(t)}},disconnect:{value:function(t){this.output.disconnect(t)}},connectInOrder:{value:function(t){for(var e=t.length-1;e--;){if(!t[e].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",t[e]);t[e+1].input?t[e].connect(t[e+1].input):t[e].connect(t[e+1])}}},getDefaults:{value:function(){var t={};for(var e in this.defaults)t[e]=this.defaults[e].value;return t}},automate:{value:function(t,e,i,a){var s,o=a?~~(a/1e3):n.currentTime,r=i?~~(i/1e3):0,u=this.defaults[t],c=this[t];c?u.automatable?(i?(s=l,c.cancelScheduledValues(o),c.setValueAtTime(c.value,o)):s=h,c[s](e,r+o)):c=e:console.error("Invalid Property for "+this.name)}}}),f="float",p="boolean",v="int";r.prototype.Filter=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.activateNode=n.createGainNode(),this.filter=n.createBiquadFilter(),this.output=n.createGainNode(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=t.frequency||this.defaults.frequency.value,this.Q=t.resonance||this.defaults.Q.value,this.filterType=t.filterType||this.defaults.filterType.value,this.gain=t.gain||this.defaults.gain.value,this.bypass=t.bypass||!1},r.prototype.Filter.prototype=Object.create(d,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:f},Q:{value:1,min:.001,max:100,automatable:!0,type:f},gain:{value:0,min:-40,max:40,automatable:!0,type:f},bypass:{value:!0,automatable:!1,type:p},filterType:{value:1,min:0,max:7,automatable:!1,type:v}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(t){this.filter.type=t}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(t){this.filter.Q.value=t}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(t){this.filter.gain.value=t}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),r.prototype.Cabinet=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.activateNode=n.createGainNode(),this.convolver=this.newConvolver(t.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=n.createGainNode(),this.output=n.createGainNode(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=t.makeupGain||this.defaults.makeupGain,this.bypass=t.bypass||!1},r.prototype.Cabinet.prototype=Object.create(d,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:f},bypass:{value:!1,automatable:!1,type:p}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=t}},newConvolver:{value:function(t){return new o.Convolver({impulse:t,dryLevel:0,wetLevel:1})}}}),r.prototype.Chorus=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.attenuator=this.activateNode=n.createGainNode(),this.splitter=n.createChannelSplitter(2),this.delayL=n.createDelayNode(),this.delayR=n.createDelayNode(),this.feedbackGainNodeLR=n.createGainNode(),this.feedbackGainNodeRL=n.createGainNode(),this.merger=n.createChannelMerger(2),this.output=n.createGainNode(),this.lfoL=new o.LFO({target:this.delayL.delayTime,callback:c}),this.lfoR=new o.LFO({target:this.delayR.delayTime,callback:c}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=t.feedback||this.defaults.feedback.value,this.rate=t.rate||this.defaults.rate.value,this.delay=t.delay||this.defaults.delay.value,this.depth=t.depth||this.defaults.depth.value,this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},r.prototype.Chorus.prototype=Object.create(d,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:f},delay:{value:.0045,min:0,max:1,automatable:!1,type:f},depth:{value:.7,min:0,max:1,automatable:!1,type:f},rate:{value:1.5,min:0,max:8,automatable:!1,type:f},bypass:{value:!0,automatable:!1,type:p}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(t){this._delay=2e-4*2*Math.pow(10,t),this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),r.prototype.Compressor=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.compNode=this.activateNode=n.createDynamicsCompressor(),this.makeupNode=n.createGainNode(),this.output=n.createGainNode(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=t.automakeup||this.defaults.automakeup.value,this.makeupGain=t.makeupGain||this.defaults.makeupGain.value,this.threshold=t.threshold||this.defaults.threshold.value,this.release=t.release||this.defaults.release.value,this.attack=t.attack||this.defaults.attack.value,this.ratio=t.ratio||this.defaults.ratio.value,this.knee=t.knee||this.defaults.knee.value,this.bypass=t.bypass||!1},r.prototype.Compressor.prototype=Object.create(d,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:f},release:{value:250,min:10,max:2e3,automatable:!0,type:f},makeupGain:{value:1,min:1,max:100,automatable:!0,type:f},attack:{value:1,min:0,max:1e3,automatable:!0,type:f},ratio:{value:4,min:1,max:50,automatable:!0,type:f},knee:{value:5,min:0,max:40,automatable:!0,type:f},automakeup:{value:!1,automatable:!1,type:p},bypass:{value:!0,automatable:!1,type:p}}},computeMakeup:{value:function(){var t=4,e=this.compNode;return-(e.threshold.value-e.threshold.value/e.ratio.value)/t}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(t){this._automakeup=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(t){this.compNode.threshold.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(t){this.compNode.ratio.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(t){this.compNode.knee.value=t,this._automakeup&&(this.makeupGain=this.computeMakeup())
}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(t){this.compNode.attack.value=t/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(t){this.compNode.release=t/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(t){this.makeupNode.gain.value=e(t)}}}),r.prototype.Convolver=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.activateNode=n.createGainNode(),this.convolver=n.createConvolver(),this.dry=n.createGainNode(),this.filterLow=n.createBiquadFilter(),this.filterHigh=n.createBiquadFilter(),this.wet=n.createGainNode(),this.output=n.createGainNode(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=t.dryLevel||this.defaults.dryLevel.value,this.wetLevel=t.wetLevel||this.defaults.wetLevel.value,this.highCut=t.highCut||this.defaults.highCut.value,this.buffer=t.impulse||"../impulses/ir_rev_short.wav",this.lowCut=t.lowCut||this.defaults.lowCut.value,this.level=t.level||this.defaults.level.value,this.filterHigh.type=0,this.filterLow.type=1,this.bypass=t.bypass||!1},r.prototype.Convolver.prototype=Object.create(d,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:f},lowCut:{value:20,min:20,max:22050,automatable:!0,type:f},dryLevel:{value:1,min:0,max:1,automatable:!0,type:f},wetLevel:{value:1,min:0,max:1,automatable:!0,type:f},level:{value:1,min:0,max:1,automatable:!0,type:f}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(t){this.filterLow.frequency.value=t}},highCut:{get:function(){return this.filterHigh.frequency},set:function(t){this.filterHigh.frequency.value=t}},level:{get:function(){return this.output.gain},set:function(t){this.output.gain.value=t}},dryLevel:{get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},wetLevel:{get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(t){var e=this.convolver,i=new XMLHttpRequest;return t?(i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(300>i.status&&i.status>199||302===i.status)&&n.decodeAudioData(i.response,function(t){e.buffer=t},function(t){t&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+t)})},i.send(null),void 0):(console.log("Tuna.Convolver.setBuffer: Missing impulse path!"),void 0)}}}),r.prototype.Delay=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.activateNode=n.createGainNode(),this.dry=n.createGainNode(),this.wet=n.createGainNode(),this.filter=n.createBiquadFilter(),this.delay=n.createDelayNode(),this.feedbackNode=n.createGainNode(),this.output=n.createGainNode(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=t.delayTime||this.defaults.delayTime.value,this.feedback=t.feedback||this.defaults.feedback.value,this.wetLevel=t.wetLevel||this.defaults.wetLevel.value,this.dryLevel=t.dryLevel||this.defaults.dryLevel.value,this.cutoff=t.cutoff||this.defaults.cutoff.value,this.filter.type=0,this.bypass=t.bypass||!1},r.prototype.Delay.prototype=Object.create(d,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:f},feedback:{value:.45,min:0,max:.9,automatable:!0,type:f},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:f},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:f},dryLevel:{value:1,min:0,max:1,automatable:!0,type:f}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(t){this.delay.delayTime.value=t/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(t){this.wet.gain.value=t}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(t){this.dry.gain.value=t}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(t){this.feedbackNode.gain.value=t}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(t){this.filter.frequency.value=t}}}),r.prototype.Overdrive=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.activateNode=n.createGainNode(),this.inputDrive=n.createGainNode(),this.waveshaper=n.createWaveShaper(),this.outputDrive=n.createGainNode(),this.output=n.createGainNode(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=t.drive||this.defaults.drive.value,this.outputGain=t.outputGain||this.defaults.outputGain.value,this.curveAmount=t.curveAmount||this.defaults.curveAmount.value,this.algorithmIndex=t.algorithmIndex||this.defaults.algorithmIndex.value,this.bypass=t.bypass||!1},r.prototype.Overdrive.prototype=Object.create(d,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:f,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:f,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:f},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:v}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(t){this._drive=t}},curveAmount:{get:function(){return this._curveAmount},set:function(t){this._curveAmount=t,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(t){this._outputGain=e(t)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(t){this._algorithmIndex=t,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(t,e,i){t=Math.min(t,.9999);var a,s,n=2*t/(1-t);for(a=0;e>a;a++)s=2*a/e-1,i[a]=(1+n)*s/(1+n*Math.abs(s))},function(t,e,i){var a,n,o;for(a=0;e>a;a++)n=2*a/e-1,o=(.5*Math.pow(n+1.4,2)-1)*o>=0?5.8:1.2,i[a]=s(o)},function(t,e,i){var a,n,o,r=1-t;for(a=0;e>a;a++)n=2*a/e-1,o=0>n?-Math.pow(Math.abs(n),r+.04):Math.pow(n,r),i[a]=s(2*o)},function(t,e,i){var s,n,o,r,u=1-t>.99?.99:1-t;for(s=0;e>s;s++)n=2*s/e-1,r=Math.abs(n),u>r?o=r:r>u?o=u+(r-u)/(1+Math.pow((r-u)/(1-u),2)):r>1&&(o=r),i[s]=a(n)*o*(1/((u+1)/2))},function(t,e,i){var a,s;for(a=0;e>a;a++)s=2*a/e-1,i[a]=-.08905>s?-3/4*(1-Math.pow(1-(Math.abs(s)-.032857),12)+1/3*(Math.abs(s)-.032847))+.01:s>=-.08905&&.320018>s?-6.153*s*s+3.9375*s:.630035},function(t,e,i){var a,s,n=2+Math.round(14*t),o=Math.round(Math.pow(2,n-1));for(a=0;e>a;a++)s=2*a/e-1,i[a]=Math.round(s*o)/o}]}}),r.prototype.Phaser=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.splitter=this.activateNode=n.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=n.createGainNode(),this.feedbackGainNodeR=n.createGainNode(),this.merger=n.createChannelMerger(2),this.filteredSignal=n.createGainNode(),this.output=n.createGainNode(),this.lfoL=new o.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new o.LFO({target:this.filtersR,callback:this.callback});for(var e=this.stage;e--;)this.filtersL[e]=n.createBiquadFilter(),this.filtersR[e]=n.createBiquadFilter(),this.filtersL[e].type=7,this.filtersR[e].type=7;this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=t.rate||this.defaults.rate.value,this.baseModulationFrequency=t.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=t.depth||this.defaults.depth.value,this.feedback=t.feedback||this.defaults.feedback.value,this.stereoPhase=t.stereoPhase||this.defaults.stereoPhase.value,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},r.prototype.Phaser.prototype=Object.create(d,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:f},depth:{value:.6,min:0,max:1,automatable:!1,type:f},feedback:{value:.7,min:0,max:1,automatable:!1,type:f},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:f},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:f}}},callback:{value:function(t,e){for(var i=0;4>i;i++)t[i].frequency.value=e}},depth:{get:function(){return this._depth},set:function(t){this._depth=t,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(t){this._baseModulationFrequency=t,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(t){this._feedback=t,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=i(e,2*Math.PI),this.lfoR._phase=e}}}),r.prototype.Tremolo=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.splitter=this.activateNode=n.createChannelSplitter(2),this.amplitudeL=n.createGainNode(),this.amplitudeR=n.createGainNode(),this.merger=n.createChannelMerger(2),this.output=n.createGainNode(),this.lfoL=new o.LFO({target:this.amplitudeL.gain,callback:c}),this.lfoR=new o.LFO({target:this.amplitudeR.gain,callback:c}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=t.rate||this.defaults.rate.value,this.intensity=t.intensity||this.defaults.intensity.value,this.stereoPhase=t.stereoPhase||this.defaults.stereoPhase.value,this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=t.bypass||!1},r.prototype.Tremolo.prototype=Object.create(d,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:f},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:f},rate:{value:5,min:.1,max:11,automatable:!1,type:f}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(t){this._intensity=t,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(t){this._rate=t,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._rate},set:function(t){this._stereoPhase=t;var e=this.lfoL._phase+this._stereoPhase*Math.PI/180;e=i(e,2*Math.PI),this.lfoR.phase=e}}}),r.prototype.WahWah=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.activateNode=n.createGainNode(),this.envelopeFollower=new o.EnvelopeFollower({target:this,callback:function(t,e){t.sweep=e}}),this.filterBp=n.createBiquadFilter(),this.filterPeaking=n.createBiquadFilter(),this.output=n.createGainNode(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=t.enableAutoMode||this.defaults.automode.value,this.resonance=t.resonance||this.defaults.resonance.value,this.sensitivity=t.sensitivity||this.defaults.sensitivity.value,this.baseFrequency=t.baseFrequency||this.defaults.baseFrequency.value,this.excursionOctaves=t.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=t.sweep||this.defaults.sweep.value,this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=t.bypass||!1},r.prototype.WahWah.prototype=Object.create(d,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:p},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:f},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:f},sweep:{value:.2,min:0,max:1,automatable:!1,type:f},resonance:{value:10,min:1,max:100,automatable:!1,type:f},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:f}}},activateCallback:{value:function(t){this.automode=t}},automode:{get:function(){return this._automode},set:function(t){this._automode=t,t?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(t){this._sweep=Math.pow(t>1?1:0>t?0:t,this._sensitivity),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=50*Math.pow(10,2*t),this._excursionFrequency=Math.min(this.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(t){this._excursionOctaves=t,this._excursionFrequency=Math.min(this.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(t){this._sensitivity=Math.pow(10,t)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(t){this._resonance=t,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type=5,this.filterBp.type=2,this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1,this.sampleRate=n.sampleRate}}}),r.prototype.EnvelopeFollower=function(t){t||(t=this.getDefaults()),this.input=n.createGainNode(),this.jsNode=this.output=n.createJavaScriptNode(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=t.attackTime||this.defaults.attackTime.value,this.releaseTime=t.releaseTime||this.defaults.releaseTime.value,this._envelope=0,this.target=t.target||{},this.callback=t.callback||function(){}},r.prototype.EnvelopeFollower.prototype=Object.create(d,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:f},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:f}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(t){this._attackTime=t,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(t){this._releaseTime=t,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(t){"function"==typeof t?this._callback=t:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(n.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(t){return function(e){t.compute(e)}}},compute:{value:function(t){var e,i,a,s,n=t.inputBuffer.getChannelData(0).length,o=t.inputBuffer.numberOfChannels;if(i=a=s=0,o>1)for(s=0;n>s;++s)for(;o>i;++i)e=t.inputBuffer.getChannelData(i)[s],a+=e*e/o;else for(s=0;n>s;++s)e=t.inputBuffer.getChannelData(0)[s],a+=e*e;a=Math.sqrt(a),a>this._envelope?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*a):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*a),this._callback(this._target,this._envelope)}}}),r.prototype.LFO=function(t){this.output=n.createJavaScriptNode(256,1,1),this.activateNode=n.destination,this.frequency=t.frequency||this.defaults.frequency.value,this.offset=t.offset||this.defaults.offset.value,this.oscillation=t.oscillation||this.defaults.oscillation.value,this.phase=t.phase||this.defaults.phase.value,this.target=t.target||{},this.output.onaudioprocess=this.callback(t.callback||function(){}),this.bypass=t.bypass||!1},r.prototype.LFO.prototype=Object.create(d,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:f},offset:{value:.85,min:0,max:22049,automatable:!1,type:f},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:f},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:f}}},frequency:{get:function(){return this._frequency},set:function(t){this._frequency=t,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(t){this._offset=t}},oscillation:{get:function(){return this._oscillation},set:function(t){this._oscillation=t}},phase:{get:function(){return this._phase},set:function(t){this._phase=t}},target:{get:function(){return this._target},set:function(t){this._target=t}},activate:{value:function(t){t?this.output.connect(n.destination):this.output.disconnect(n.destination)}},callback:{value:function(t){var e=this;return function(){e._phase+=e._phaseInc,e._phase>2*Math.PI&&(e._phase=0),t(e._target,e._offset+e._oscillation*Math.sin(e._phase))}}}}),r.toString=r.prototype.toString=function(){return"You are running Tuna version "+u+" by Dinahmoe!"},"function"==typeof define?define("Tuna",[],function(){return r}):t.Tuna=r}(this),function(){var t;t="undefined"!=typeof exports&&null!==exports?exports:this,t.mixer={Models:{},Collections:{},Views:{},Routers:{},Templates:{},log:function(t,e,i,a){var s,n;return null==a&&(a=i),n=Math.log(i/e)/Math.LN2,s=Math.pow(2,n*(t-1)),a*s},init:function(){var t,e,i,a;return t="files/WalterWhite.mp3",e="files/Superliminal.mp3",i=new mixer.Views.TrackView({el:"#track1",url:t}),a=new mixer.Views.TrackView({el:"#track2",url:e})}},$(function(){return mixer.init()})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,i){function a(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return a.prototype=i.prototype,e.prototype=new a,e.__super__=i.prototype,e};mixer.Views.TrackView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=mixer.Templates.track,i.prototype.initialize=function(t){var e,i,a,s,n,o,r,u,h=this;return this.$el.html(this.template()),this.wavesurfer=Object.create(WaveSurfer),this.wavesurfer.init({canvas:this.$(".waveform").get(0),markerColor:"rgba(0, 0, 0, 0.5)",frameMargin:.1,maxSecPerPx:1,scrollParent:!0,loadPercent:!0,waveColor:"gray",progressColor:"orange",loadingColor:"orange",cursorColor:"navy"}),e=this.$(".bpm"),this.i=0,n=0,this.kick=this.wavesurfer.createKick({frequency:[0,10],threshold:.5,decay:.005,onKick:function(t,i){return h.showBeats(h.i++),0===n&&(n=i),e.html((""+60*(h.i/(i-n))).slice(0,5))}}),this.wavesurfer.load(t.url,{progress:function(){},load:function(){return h.kick.on(),h.$(".disabled").removeClass("disabled")}}),this.wavesurfer.bindDragNDrop(this.$el.get(0)),this.$(".sslider").slider({min:.1,max:5,step:.1,value:1,formater:function(t){return(""+t).slice(0,4)}}).on("slide",function(t){return h.wavesurfer.setPlaybackRate(t.value)}),this.$(".vslider").slider({min:0,max:1,step:.1,value:1,formater:function(t){return(""+t).slice(0,4)}}).on("slide",function(t){var e,i;return e=0===t.value?'<i class="icon-volume-off"></i>':(i=t.value)>0&&.5>i?'<i class="icon-volume-down"></i>':'<i class="icon-volume-up"></i>',h.$(".volume").children().replaceWith($(e)),h.wavesurfer.setVolume(t.value)}),this.$(".fslider").slider({min:0,max:1,step:.01,value:1,formater:function(t){var e,i;return i=""+h.wavesurfer.changeFilterFrequency(t),e=i.indexOf("."),i.slice(0,0>e?i.length:e+2)+"Hz"}}),this.$(".qslider").slider({min:0,max:1,step:.01,value:1,formater:function(t){return(""+h.wavesurfer.changeFilterQuality(t)).slice(0,7)}}),this.$(".gslider").slider({min:-1,max:1,step:.01,value:0,formater:function(t){return(""+h.wavesurfer.changeFilterGain(t)).slice(0,4)}}),a=this.$(".fft").get(0),i=a.getContext("2d"),s=a.height,r=a.width,u=1,o=1,i.fillStyle="orange",this.wavesurfer.bind("update",function(){var t,e,a,n,l,c;if(l=h.wavesurfer.getSpectrum(),n=_.max(l),0!==n){for(i.clearRect(0,0,r,s),a=l.length,e=0,l=_.map(l,function(t){return t/.1}),c=[];a>e;)t=l[e]*s,i.fillRect(e*(o+u),s,u,-t),c.push(e++);return c}})},i.prototype.events={"click .icon-backward":"onBackward","click .icon-play":"onPlay","click .icon-stop":"onStop","click .icon-pause":"onPause","click .icon-forward":"onForward","click .icon-resize-full":"onZoomIn","click .icon-resize-small":"onZoomOut","click canvas":"onSeek","change #filtertype":"onChangeFilterType","change #enableFilter":"onToggleFilter","change #enableChorus":"onToggleChorus"},i.prototype.showPlay=function(){return this.$(".icon-pause").replaceWith($('<i class="icon-play"></i>'))},i.prototype.showPause=function(){return this.$(".icon-play").replaceWith($('<i class="icon-pause"></i>'))},i.prototype.onBackward=function(){return this.showPause(),this.wavesurfer.skipBackward()},i.prototype.onPlay=function(){return this.showPause(),this.wavesurfer.playPause()},i.prototype.onPause=function(){return this.showPlay(),this.wavesurfer.playPause()},i.prototype.onForward=function(){return this.showPause(),this.wavesurfer.skipForward()},i.prototype.onZoomIn=function(){return this.wavesurfer.resize(1.5)},i.prototype.onZoomOut=function(){return this.wavesurfer.resize(.75)},i.prototype.onSeek=function(){return this.showPause()},i.prototype.onStop=function(){return this.wavesurfer.stop()},i.prototype.onChangeFilterType=function(t){var e;return e=$(t.currentTarget).val(),this.wavesurfer.changeFilterType(e)},i.prototype.onToggleFilter=function(t){var e;return e=$(t.currentTarget).prop("checked"),this.wavesurfer.toggleFilter(e)},i.prototype.onToggleChorus=function(t){var e;return e=$(t.currentTarget).prop("checked"),this.wavesurfer.toggleChorus(e)},i.prototype.showBeats=function(t){return this.wavesurfer.mark({id:"up"+t,color:"rgba(0, 0, 0, 0.5)"})},i}(Backbone.View)}.call(this);