(function(){var t;t="undefined"!=typeof exports&&null!==exports?exports:this,t.mixer={Models:{},Collections:{},Views:{},Routers:{},Templates:{},log:function(t,e,i,n){var s,a;return null==n&&(n=i),a=Math.log(i/e)/Math.LN2,s=Math.pow(2,a*(t-1)),n*s},init:function(){var t,e,i,n;return t="files/WalterWhite.mp3",e="files/Superliminal.mp3",i=new mixer.Views.TrackView({el:"#track1",url:t}),n=new mixer.Views.TrackView({el:"#track2",url:e})}},$(function(){return mixer.init()})}).call(this),this.mixer=this.mixer||{},this.mixer.Templates=this.mixer.Templates||{},this.mixer.Templates.track=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class="row text-center track-container">\n    <div class="track span12">\n        <canvas class="waveform" width="5000" height="100"></canvas>\n    </div>\n    <canvas class="fft" width="1280" height="100"></canvas>\n</div>\n<div class="row">\n    <div class="span4">\n        <div class="btn-toolbar">\n          <div class="btn-group">\n            <a class="btn disabled" href="#"><i class="icon-backward"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-play"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-forward"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-resize-full"></i></a>\n            <a class="btn disabled" href="#"><i class="icon-resize-small"></i></a>\n          </div>\n        </div>\n        <div class="btn-toolbar">\n          <div class="btn-group">\n            <span class="volume"><i class="icon-volume-up"></i></span>\n            <span class="vslider span3"></span>\n          </div>\n        </div>\n        <div class="btn-toolbar">\n          <div class="btn-group">\n            <span class="speed"><i class="icon-time"></i></span>\n            <span class="sslider span3"></span>\n          </div>\n        </div>\n        <div>\n            BPM <span class="bpm">0</span>\n        </div>\n    </div>\n    <div class="span4">\n        <label for="filtertype">Filter Type:</label>\n        <select name="type" id="filtertype">\n            <option value="lowpass">Lowpass</option>\n            <option value="highpass">Highpass</option>\n            <option value="bandpass">Bandpass</option>\n            <option value="lowshelf">Lowshelf</option>\n            <option value="highshelf">Highshelf</option>\n            <option value="peaking">Peaking</option>\n            <option value="notch">Notch</option>\n            <option value="allpass">Allpass</option>\n        </select>\n        <label for="enableFilter">Enable Filter:</label>\n        <input type="checkbox" id="enableFilter" checked>\n        <label for="enableChorus">Enable Chorus:</label>\n        <input type="checkbox" id="enableChorus" checked>\n    </div>\n    <div class="span4">\n        <label for="fslider">Frequency Cutoff:</label>\n        <div class="fslider" style=""></div>\n        <label for="qslider">Q Factor:</label>\n        <div class="qslider" style=""></div>\n        <label for="gslider">Gain:</label>\n        <div class="gslider" style=""></div>\n    </div>\n</div>';return __p},function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};mixer.Views.TrackView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.template=mixer.Templates.track,i.prototype.initialize=function(t){var e,i,n,s,a,r,o,u,l=this;return this.$el.html(this.template()),this.wavesurfer=Object.create(WaveSurfer),this.wavesurfer.init({canvas:this.$(".waveform").get(0),markerColor:"rgba(0, 0, 0, 0.5)",frameMargin:.1,maxSecPerPx:1,scrollParent:!0,loadPercent:!0,waveColor:"gray",progressColor:"orange",loadingColor:"orange",cursorColor:"navy"}),e=this.$(".bpm"),this.i=0,a=0,this.kick=this.wavesurfer.createKick({frequency:[0,10],threshold:.5,decay:.005,onKick:function(t,i){return l.showBeats(l.i++),0===a&&(a=i),e.html((""+60*(l.i/(i-a))).slice(0,5))}}),this.wavesurfer.load(t.url,{progress:function(){},load:function(){return l.kick.on(),l.$(".disabled").removeClass("disabled")}}),this.wavesurfer.bindDragNDrop(this.$el.get(0)),this.$(".sslider").slider({min:.1,max:5,step:.1,value:1,formater:function(t){return(""+t).slice(0,4)}}).on("slide",function(t){return l.wavesurfer.setPlaybackRate(t.value)}),this.$(".vslider").slider({min:0,max:1,step:.1,value:1,formater:function(t){return(""+t).slice(0,4)}}).on("slide",function(t){var e,i;return e=0===t.value?'<i class="icon-volume-off"></i>':(i=t.value)>0&&.5>i?'<i class="icon-volume-down"></i>':'<i class="icon-volume-up"></i>',l.$(".volume").children().replaceWith($(e)),l.wavesurfer.setVolume(t.value)}),this.$(".fslider").slider({min:0,max:1,step:.01,value:1,formater:function(t){var e,i;return i=""+l.wavesurfer.changeFilterFrequency(t),e=i.indexOf("."),i.slice(0,0>e?i.length:e+2)+"Hz"}}),this.$(".qslider").slider({min:0,max:1,step:.01,value:1,formater:function(t){return(""+l.wavesurfer.changeFilterQuality(t)).slice(0,7)}}),this.$(".gslider").slider({min:-1,max:1,step:.01,value:0,formater:function(t){return(""+l.wavesurfer.changeFilterGain(t)).slice(0,4)}}),n=this.$(".fft").get(0),i=n.getContext("2d"),s=n.height,o=n.width,u=1,r=1,i.fillStyle="orange",this.wavesurfer.bind("update",function(){var t,e,n,a,c,h;if(c=l.wavesurfer.getSpectrum(),a=_.max(c),0!==a){for(i.clearRect(0,0,o,s),n=c.length,e=0,c=_.map(c,function(t){return t/.1}),h=[];n>e;)t=c[e]*s,i.fillRect(e*(r+u),s,u,-t),h.push(e++);return h}})},i.prototype.events={"click .icon-backward":"onBackward","click .icon-play":"onPlay","click .icon-pause":"onPause","click .icon-forward":"onForward","click .icon-resize-full":"onZoomIn","click .icon-resize-small":"onZoomOut","click canvas":"onSeek","change #filtertype":"onChangeFilterType","change #enableFilter":"onToggleFilter","change #enableChorus":"onToggleChorus"},i.prototype.showPlay=function(){return this.$(".icon-pause").replaceWith($('<i class="icon-play"></i>'))},i.prototype.showPause=function(){return this.$(".icon-play").replaceWith($('<i class="icon-pause"></i>'))},i.prototype.onBackward=function(){return this.showPause(),this.wavesurfer.skipBackward()},i.prototype.onPlay=function(){return this.showPause(),this.wavesurfer.playPause()},i.prototype.onPause=function(){return this.showPlay(),this.wavesurfer.playPause()},i.prototype.onForward=function(){return this.showPause(),this.wavesurfer.skipForward()},i.prototype.onZoomIn=function(){return this.wavesurfer.resize(1.5)},i.prototype.onZoomOut=function(){return this.wavesurfer.resize(.75)},i.prototype.onSeek=function(){return this.showPause()},i.prototype.onChangeFilterType=function(t){var e;return e=$(t.currentTarget).val(),this.wavesurfer.changeFilterType(e)},i.prototype.onToggleFilter=function(t){var e;return e=$(t.currentTarget).prop("checked"),this.wavesurfer.toggleFilter(e)},i.prototype.onToggleChorus=function(t){var e;return e=$(t.currentTarget).prop("checked"),this.wavesurfer.toggleChorus(e)},i.prototype.showBeats=function(t){return this.wavesurfer.mark({id:"up"+t,color:"rgba(0, 0, 0, 0.5)"})},i}(Backbone.View)}.call(this);